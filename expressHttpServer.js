const express = require('express');
const app = express();
var request = require('request');

app.set('views', __dirname + '/views');
app.set('view engine', 'ejs');

app.use(express.static(__dirname + '/public'));
app.use(express.json());
app.use(express.urlencoded({ extended: false }));

app.get('/signup', function (req, res) {
    res.render('signup');
})

app.get('/authResult', function (req, res) {
    var authCode = req.query.code;
    console.log(authCode);

    var option = {
        method: "POST",
        url: "https://testapi.openbanking.or.kr/oauth/2.0/token",
        headers : {
            'Content-Type' : "application/x-www-form-urlencoded; charset=UTF-8"
        },
        form: {
            code: authCode,
            client_id: 'q7kH44ThJwjpvNRg0BbJvE1yxvx5X53DKz1rNgPF',
            client_secret: 'yVT6irMr2h4ZTHzZY7sDpbvhm1nlOzr4nP7DYRVy',
            redirect_uri: 'http://localhost:3000/authResult',
            grant_type: 'authorization_code'
        }
    }

    request(option, function (error, response, body) {
        var parseData = JSON.parse(body);
        res.render('resultChild', {data : parseData});
    });
})


app.listen(3000)